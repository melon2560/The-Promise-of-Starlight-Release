name: Build and Release (Windows)

on:
  push:
    tags:
      - "v*"

jobs:
  build-windows:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Godot 4.5.1 (headless + templates)
        uses: firebelley/setup-godot@v2
        with:
          version: "4.5.1"
          use-headless: true
          install-export-templates: true

      - name: Export Windows build
        run: |
          mkdir -p build/windows
          godot -v --headless --export-release "Windows Desktop" build/windows/starlight.exe

      - name: Create zip
        run: |
          cd build/windows
          zip -r ../starlight-win.zip .

      - name: Publish GitHub Release asset
        uses: softprops/action-gh-release@v1
        with:
          files: build/starlight-win.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
